<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title><%= meta.title %></title>
        <meta name="description" content="<%= meta.description %>" />
        <meta name="keywords" content="<%= meta.keywords %>" />
        <link rel="stylesheet" href="/stylesheets/style.css" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
    </head>
    <body>
        <div class="container">
            <h1><%= body.title %></h1>
            <p>Welcome to <%= body.title %></p>

            <hr class="my-4" />

            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">
                        <i class="bi bi-cloud-upload"></i> T·∫£i l√™n ·∫£nh
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="search-tab" data-bs-toggle="tab" data-bs-target="#search" type="button" role="tab">
                        <i class="bi bi-search"></i> T√¨m ki·∫øm AI
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                        <i class="bi bi-gear"></i> C√†i ƒë·∫∑t
                    </button>
                </li>
            </ul>

            <!-- Tab content -->
            <div class="tab-content" id="myTabContent">
                <!-- Upload Tab -->
                <div class="tab-pane fade show active" id="upload" role="tabpanel">
                    <div class="container mt-4">
                        <form class="row gy-2 gx-3 align-items-center" id="uploadForm" method="post" enctype="multipart/form-data">
                            <div class="col-6">
                                <div class="mb-3">
                                    <label class="form-label" for="image">T·∫£i l√™n ·∫£nh:</label>
                                    <input class="form-control" type="file" name="image" accept="image/*" required multiple />
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" for="title">Ti√™u ƒë·ªÅ:</label>
                                    <input class="form-control" type="text" name="title" placeholder="Ti√™u ƒë·ªÅ (t√πy ch·ªçn)" />
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" for="description">M√¥ t·∫£:</label>
                                    <textarea class="form-control" name="description" placeholder="M√¥ t·∫£ (t√πy ch·ªçn)"></textarea>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" for="tags">Th·∫ª (tags):</label>
                                    <input class="form-control" type="text" name="tags" placeholder="nature, landscape, sky..." />
                                </div>

                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-cloud-upload"></i> T·∫£i l√™n
                                </button>
                            </div>

                            <div class="col-auto">
                                <img id="uploadPreview" 
                                    src="https://static.vecteezy.com/system/resources/thumbnails/004/141/669/small_2x/no-photo-or-blank-image-icon-loading-images-or-missing-image-mark-image-not-available-or-image-coming-soon-sign-simple-nature-silhouette-in-frame-isolated-illustration-vector.jpg"
                                    alt="Preview" class="img-fluid" style="max-height: 300px;" />
                            </div>
                        </form>
                    </div>
                </div>

                <!-- AI Search Tab -->
                <div class="tab-pane fade" id="search" role="tabpanel">
                    <div class="container mt-4">
                        <form class="row gy-2 gx-3" id="searchForm" method="post" enctype="multipart/form-data">
                            <div class="col-6">
                                <div class="mb-3">
                                    <label class="form-label" for="searchImage">
                                        <i class="bi bi-camera"></i> ·∫¢nh t√¨m ki·∫øm:
                                    </label>
                                    <input class="form-control" type="file" name="image" id="searchImage" accept="image/*" required />
                                    <div class="form-text">T·∫£i l√™n ·∫£nh ƒë·ªÉ t√¨m nh·ªØng ·∫£nh t∆∞∆°ng t·ª±</div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="minSimilarity">
                                                ƒê·ªô t∆∞∆°ng ƒë·ªìng: <span id="similarityValue">0.65</span>
                                            </label>
                                            <input type="range" class="form-range" name="min_similarity" id="minSimilarity" 
                                                   min="0.1" max="1.0" step="0.05" value="0.65" />
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            <label class="form-label" for="topK">S·ªë k·∫øt qu·∫£:</label>
                                            <select class="form-select" name="top_k" id="topK">
                                                <option value="10">10 k·∫øt qu·∫£</option>
                                                <option value="20">20 k·∫øt qu·∫£</option>
                                                <option value="50" selected>50 k·∫øt qu·∫£</option>
                                                <option value="100">100 k·∫øt qu·∫£</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label" for="category">Danh m·ª•c (t√πy ch·ªçn):</label>
                                    <input class="form-control" type="text" name="category" id="category" placeholder="nature, people, animals..." />
                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" name="enable_rerank" id="enableRerank" checked />
                                                <label class="form-check-label" for="enableRerank">Rerank Top-K</label>
                                            </div>
                                            <div class="input-group mt-2">
                                                <label class="input-group-text" for="rerankK">Top</label>
                                                <select class="form-select" name="rerank_k" id="rerankK">
                                                    <option value="3">3</option>
                                                    <option value="5" selected>5</option>
                                                    <option value="10">10</option>
                                                    <option value="20">20</option>
                                                </select>
                                            </div>
                                            <div class="form-text">Augment l√† c√¥ng t·∫Øc to√†n c·ª•c trong tab C√†i ƒë·∫∑t.</div>
                                        </div>
                                    </div>
                                </div>

                                <button class="btn btn-success" type="submit">
                                    <i class="bi bi-search"></i> T√¨m ki·∫øm AI
                                </button>
                            </div>

                            <div class="col-auto">
                                <div id="searchPreview" style="display: none;">
                                    <h6>üîç ·∫¢nh t√¨m ki·∫øm:</h6>
                                    <img id="previewImage" class="img-fluid rounded border" style="max-height: 250px;" />
                                </div>

                                <!-- Search Results Stats -->
                                <div id="searchStats" class="mt-3" style="display: none;">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">üìä K·∫øt qu·∫£ t√¨m ki·∫øm</h6>
                                        <div><strong>S·ªë ·∫£nh:</strong> <span id="totalResults">0</span></div>
                                        <div class="row row-cols-2 mt-2">
                                            <div><strong>T·ªïng:</strong> <span id="searchTime">0</span>s</div>
                                            <div><strong>ƒê·∫∑c tr∆∞ng:</strong> <span id="featureTime">-</span>s</div>
                                            <div><strong>Similarity:</strong> <span id="similarityTime">-</span>s</div>
                                            <div><strong>S·∫Øp x·∫øp:</strong> <span id="sortingTime">-</span>s</div>
                                            <div><strong>Rerank:</strong> <span id="rerankTime">-</span>s</div>
                                        </div>
                                        <div class="mt-2"><strong>Model:</strong> <span id="modelUsed">-</span></div>
                                        <div><strong>Augmentation (k·∫øt qu·∫£):</strong> <span id="augmentationUsed">-</span></div>
                                        <div><strong>Augmentation (to√†n c·ª•c):</strong> <span id="augmentationGlobal">-</span></div>
                                        <div><strong>Rerank:</strong> <span id="rerankUsed">-</span></div>
                                        <div><strong>Cache hit:</strong> <span id="cacheHit">-</span></div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="tab-pane fade" id="settings" role="tabpanel">
                    <div class="container mt-4">
                        <div class="row">
                            <div class="col-6">
                                <h5><i class="bi bi-gear"></i> Qu·∫£n l√Ω h·ªá th·ªëng</h5>
                                
                                <div class="d-grid gap-2 mb-3">
                                    <button class="btn btn-outline-info" id="statsBtn">
                                        <i class="bi bi-bar-chart"></i> Xem th·ªëng k√™ h·ªá th·ªëng
                                    </button>
                                    
                                    <button class="btn btn-outline-warning" id="rebuildBtn">
                                        <i class="bi bi-arrow-clockwise"></i> Rebuild AI Embeddings
                                    </button>
                                    
                                    <button class="btn btn-outline-danger" id="clearCacheBtn">
                                        <i class="bi bi-trash"></i> X√≥a Cache h·ªá th·ªëng
                                    </button>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="globalAugmentation" checked />
                                        <label class="form-check-label" for="globalAugmentation">
                                            <strong>Augmentation to√†n c·ª•c</strong>
                                        </label>
                                        <div class="form-text">B·∫≠t/t·∫Øt tƒÉng c∆∞·ªùng AI cho to√†n h·ªá th·ªëng</div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-6">
                                <h5>üìä Tr·∫°ng th√°i h·ªá th·ªëng</h5>
                                <div class="card">
                                    <div class="card-body">
                                        <div id="systemStatus" class="small">
                                            <div class="d-flex justify-content-center">
                                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                                <span class="ms-2">ƒêang t·∫£i...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr class="my-4" />

            <!-- Gallery Section -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 id="pageTitle">
                    <i class="bi bi-images"></i> Kho ·∫£nh
                </h2>
                
                <!-- View Mode Toggle -->
                <div class="btn-group btn-group-sm" role="group">
                    <input type="radio" class="btn-check" name="viewMode" id="gridView" autocomplete="off" checked />
                    <label class="btn btn-outline-secondary" for="gridView">
                        <i class="bi bi-grid-3x3"></i> L∆∞·ªõi
                    </label>
                    
                    <input type="radio" class="btn-check" name="viewMode" id="listView" autocomplete="off" />
                    <label class="btn btn-outline-secondary" for="listView">
                        <i class="bi bi-list"></i> Danh s√°ch
                    </label>
                </div>
            </div>

            <div id="gallery" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-4 g-4"></div>
            
            <nav class="mt-3">
                <div class="d-flex justify-content-between align-items-center">
                    <button class="btn btn-outline-secondary" id="prevBtn">
                        <i class="bi bi-chevron-left"></i> Tr∆∞·ªõc
                    </button>
                    <span id="pageInfo" class="mx-2">Page 1</span>
                    <button class="btn btn-outline-secondary" id="nextBtn">
                        Sau <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </nav>
        </div>

        <!-- Loading Modal -->
        <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body text-center">
                        <div class="spinner-border text-primary mb-3" role="status"></div>
                        <div id="loadingText">ƒêang x·ª≠ l√Ω...</div>
                    </div>
                </div>
            </div>
        </div>

        <script src="/javascripts/script.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    </body>
</html>
